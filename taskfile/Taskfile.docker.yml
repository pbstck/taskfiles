version: '3'

internal: true

includes:
  common:
    taskfile: ./Taskfile.common.yml

tasks:
  deliver:
    deps: [common:ecr-login]
    requires:
      vars: [BINARY_NAME, GIT_REVISION]
    cmds:
      - docker push 563565546264.dkr.ecr.eu-west-1.amazonaws.com/{{.BINARY_NAME}}:{{.GIT_REVISION}}

  build:
    deps: [common:ecr-login]
    requires:
      vars: [BINARY_NAME, GIT_REVISION]
    cmds:
      - docker build -t 563565546264.dkr.ecr.eu-west-1.amazonaws.com/{{.BINARY_NAME}}:{{.GIT_REVISION}} .